#!/usr/bin/env bash
set -euo pipefail

LAYERS=(
"LAYER 0 — QWERTY

┌─────────┬───┬───┬───┬───┬───┐       ┌───┬───┬───┬───┬───┬─────────┐
│ ESC/Alt │ Q │ W │ E │ R │ T │       │ Y │ U │ I │ O │ P │  \\ /Alt │
├─────────┼───┼───┼───┼───┼───┤       ├───┼───┼───┼───┼───┼─────────┤
│  CTRL   │ A │ S │ D │ F │ G │       │ H │ J │ K │ L │ ; │  ' /Ctrl│
├─────────┼───┼───┼───┼───┼───┤       ├───┼───┼───┼───┼───┼─────────┤
│ CAPSWORD│ Z │ X │ C │ V │ B │       │ N │ M │ , │ . │ / │  - /Shft│
└─────────┴───┴───┼───┼───┼───┤       ├───┼───┼───┼───┴───┴─────────┘
                  │DG\`│ESC│SPC│       │RET│TAB│GUI│
                  │   │NUM│SFT│       │   │SYM│   │
                  └───┴───┴───┘       └───┴───┴───┘"

"LAYER 1 — NUMBER (hold ESC/NUM)

┌─────────┬───┬───┬───┬───┬───┐       ┌───┬───┬───┬───┬───┬─────────┐
│   BS    │ 1 │ 2 │ 3 │ 4 │ 5 │       │ + │ - │ * │ / │ = │   DEL   │
├─────────┼───┼───┼───┼───┼───┤       ├───┼───┼───┼───┼───┼─────────┤
│ (Ctrl)  │ 6 │ 7 │ 8 │ 9 │ 0 │       │ ← │ ↓ │ ↑ │ → │   │         │
├─────────┼───┼───┼───┼───┼───┤       ├───┼───┼───┼───┼───┼─────────┤
│(CAPSW)  │   │   │ , │ . │ : │       │HOM│PGD│PGU│END│   │         │
└─────────┴───┴───┼───┼───┼───┤       ├───┼───┼───┼───┴───┴─────────┘
                  │DG\`│***│SPC│       │RET│(S)│GUI│
                  │   │NUM│SFT│       │   │   │   │
                  └───┴───┴───┘       └───┴───┴───┘"

"LAYER 2 — SYMBOL (hold TAB/SYM)

┌─────────┬───┬───┬───┬───┬───┐       ┌───┬───┬───┬───┬───┬─────────┐
│   BS    │ # │ @ │ { │ } │ \\ │       │ | │ _ │ < │ > │   │   DEL   │
├─────────┼───┼───┼───┼───┼───┤       ├───┼───┼───┼───┼───┼─────────┤
│ (Ctrl)  │ ! │ \$ │ ( │ ) │ \` │       │ + │ - │ / │ * │ % │ (Ctrl)  │
├─────────┼───┼───┼───┼───┼───┤       ├───┼───┼───┼───┼───┼─────────┤
│(CAPSW)  │ % │ ^ │ [ │ ] │ ~ │       │ & │ = │ , │ . │ / │ (Shft)  │
└─────────┴───┴───┼───┼───┼───┤       ├───┼───┼───┼───┴───┴─────────┘
                  │DG\`│(N)│ = │       │RET│***│GUI│
                  │   │   │   │       │   │SYM│   │
                  └───┴───┴───┘       └───┴───┴───┘"

"LAYER 3 — CONTROL (hold NUM + SYM)

┌─────────┬───┬───┬───┬───┬───┐       ┌───┬───┬───┬───┬───┬─────────┐
│  VOL-   │F1 │F2 │F3 │F4 │F5 │       │F6 │F7 │F8 │F9 │F10│  VOL+   │
├─────────┼───┼───┼───┼───┼───┤       ├───┼───┼───┼───┼───┼─────────┤
│         │F11│F12│   │   │   │       │   │   │   │   │   │         │
├─────────┼───┼───┼───┼───┼───┤       ├───┼───┼───┼───┼───┼─────────┤
│  MUTE   │   │   │   │   │   │       │BT1│BT2│BT3│BT4│CLR│  MUTE   │
└─────────┴───┴───┼───┼───┼───┤       ├───┼───┼───┼───┴───┴─────────┘
                  │DG\`│***│SPC│       │RET│***│GUI│
                  │   │NUM│SFT│       │   │SYM│   │
                  └───┴───┴───┘       └───┴───┴───┘"
)

LEGEND="Legenda:
  X/Mod = tap/hold (gqt)    *** = layer attivo (tenuto)
  (X)   = ereditato (&trans) DG\` = dead grave (accenti)"

if [[ $# -eq 0 ]]; then
    for layer in "${LAYERS[@]}"; do
        echo "$layer"
        echo
    done
    echo "$LEGEND"
elif [[ $# -eq 1 && "$1" =~ ^[0-3]$ ]]; then
    echo "${LAYERS[$1]}"
    echo
    echo "$LEGEND"
else
    echo "Usage: kb [0-3]" >&2
    echo "  No args: print all layers" >&2
    echo "  0: QWERTY  1: NUMBER  2: SYMBOL  3: CONTROL" >&2
    exit 1
fi
